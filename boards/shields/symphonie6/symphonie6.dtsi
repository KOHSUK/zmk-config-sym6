#include <dt-bindings/zmk/matrix_transform.h>
#include "symphonie6-layouts.dtsi"

/ {
    chosen {
        zmk,physical-layout = &physical_layout0;
    };

    kscan0: kscan {
        compatible = "zmk,kscan-gpio-charlieplex";
        wakeup-source;
        interrupt-gpios = <&xiao_d 1 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)>;
    };

    default_transform: keymap_transform0 {
        compatible = "zmk,matrix-transform";
        rows = <12>;
        columns = <7>;
        map = <
                     RC(0,1)  RC(0,2)  RC(0,3)  RC(0,4)  RC(0,5)  RC(0,6)    RC(6,1)  RC(6,2)  RC(6,3)  RC(6,4)  RC(6,5)  RC(7,0)
            RC(1,0)  RC(1,2)  RC(1,3)  RC(1,4)  RC(1,5)  RC(2,0)  RC(2,1)    RC(7,2)  RC(7,3)  RC(7,4)  RC(7,5)  RC(8,0)  RC(8,1)  RC(8,3)
            RC(2,3)  RC(2,4)  RC(2,5)  RC(3,0)  RC(3,1)  RC(3,2)  RC(3,4)    RC(8,4)  RC(8,5)  RC(9,0)  RC(9,1)  RC(9,2)  RC(9,4)  RC(9,5)
            RC(2,6)  RC(3,5)  RC(4,0)  RC(4,1)  RC(4,2)  RC(4,3)  RC(4,5)    RC(10,0) RC(10,1) RC(10,2) RC(10,3) RC(10,5) RC(11,0) RC(12,0)
            RC(5,0)  RC(5,1)  RC(5,2)      RC(1,6)       RC(5,3)  RC(5,4)    RC(11,1)                            RC(11,2) RC(11,3) RC(11,4)
        >;
    };

    left_encoder: encoder_left {
        compatible = "alps,ec11";
        a-gpios = <&xiao_d 5 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        b-gpios = <&xiao_d 0 (GPIO_ACTIVE_HIGH | GPIO_PULL_UP)>;
        steps = <24>;
        status = "disabled";
    };

    sensors: sensors {
        compatible = "zmk,keymap-sensors";
        sensors = <&left_encoder>;
        triggers-per-rotation = <10>;
    };
};

&physical_layout0 {
    kscan = <&kscan0>; // Label of the kscan node this layout uses
    transform = <&default_transform>; // Label of the matrix transform this layout uses
};